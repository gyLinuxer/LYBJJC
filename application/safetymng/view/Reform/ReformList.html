{__NOLAYOUT__}
<!DOCTYPE html>
<html lang="en">
<head>
    <!--

              中国民用航空飞行学院洛阳分院　
                       机务工程部　
                        李光耀　
                 email: gyLinuxer@163.com
                    QQ: 447649795
                  微信: 447649795
-->

    <meta charset="utf-8">
    <title>安全管理系统v1.0</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="author" content="author">
    <!-- 网页描述 -->
    <meta name="description" content="hello">
    <!-- 关键字使用","分隔 -->
    <meta name="keywords" content="a,b,c">
    <!-- 禁止浏览器从本地机的缓存中调阅页面内容 -->
    <meta http-equiv="Pragma" content="no-cache">
    <!-- 用来防止别人在框架里调用你的页面 -->
    <meta http-equiv="Window-target" content="_top">
    <!-- content的参数有all，none，index，noindex，follow，nofollow，默认是all -->
    <meta name="robots" content="none">
    <!-- 收藏图标 -->
    <link rel="Shortcut Icon" href="favicon.ico" rel="external nofollow" >
    <!-- 网页不会被缓存 -->
    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
    <!-- 解决部分兼容性问题，如果安装了GCF，则使用GCF来渲染页面，如果未安装GCF，则使用最高版本的IE内核进行渲染。 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <!-- 页面按原比例显示 -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--[if lt IE 9]>

    <![endif]-->
    <!-- The styles -->
    <link id="bs-css" href="__PUBLIC__/css/bootstrap-cerulean.min.css" rel="stylesheet">
    <link href="__PUBLIC__/css/charisma-app.css" rel="stylesheet">
    <link href='__PUBLIC__/bower_components/fullcalendar/dist/fullcalendar.css' rel='stylesheet'>
    <link href='__PUBLIC__/bower_components/fullcalendar/dist/fullcalendar.print.css' rel='stylesheet' media='print'>
    <link href='__PUBLIC__/bower_components/chosen/chosen.min.css' rel='stylesheet'>
    <link href='__PUBLIC__/bower_components/colorbox/example3/colorbox.css' rel='stylesheet'>
    <link href='__PUBLIC__/bower_components/responsive-tables/responsive-tables.css' rel='stylesheet'>
    <link href='__PUBLIC__/bower_components/bootstrap-tour/build/css/bootstrap-tour.min.css' rel='stylesheet'>
    <link href='__PUBLIC__/css/jquery.noty.css' rel='stylesheet'>
    <link href='__PUBLIC__/css/noty_theme_default.css' rel='stylesheet'>
    <link href='__PUBLIC__/css/elfinder.min.css' rel='stylesheet'>
    <link href='__PUBLIC__/css/elfinder.theme.css' rel='stylesheet'>
    <link href='__PUBLIC__/css/jquery.iphone.toggle.css' rel='stylesheet'>
    <link href='__PUBLIC__/css/uploadify.css' rel='stylesheet'>
    <link href='__PUBLIC__/css/animate.min.css' rel='stylesheet'>
    <link href='__PUBLIC__/css/doc.min.css' rel='stylesheet'>
    <link href='__PUBLIC__/css/MyCss.css' rel='stylesheet'>
    <link href='__PUBLIC__/css/jquery-ui.min.css' rel='stylesheet'>

    <link href="__PUBLIC__/css/bootstrap-table.css" rel="stylesheet">
    <link href="__PUBLIC__/css/zTreeStyle/zTreeStyle.css" rel="stylesheet">
    <link href="__PUBLIC__/css/bootstrap-editable.css" rel="stylesheet">
    <link href="__PUBLIC__/css/ui-dialog.css" rel="stylesheet">
    <!-- jQuery -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.js"></script>

    <!-- include summernote css/js -->
    <link href="http://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.11/summernote.css" rel="stylesheet">
    <script src="http://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.11/summernote.js"></script>

    <!-- library for cookie management -->
    <script src="__PUBLIC__/js/jquery.cookie.js"></script>
    <!-- calender plugin -->

    <!-- data table plugin -->
    <script src='__PUBLIC__/js/jquery.dataTables.min.js'></script>

    <!-- select or dropdown enhancer -->
    <script src="__PUBLIC__/bower_components/chosen/chosen.jquery.min.js"></script>
    <!-- plugin for gallery image view -->
    <script src="__PUBLIC__/bower_components/colorbox/jquery.colorbox-min.js"></script>
    <!-- notification plugin -->
    <script src="__PUBLIC__/js/jquery.noty.js"></script>
    <!-- library for making tables responsive -->
    <script src="__PUBLIC__/bower_components/responsive-tables/responsive-tables.js"></script>
    <!-- tour plugin -->
    <script src="__PUBLIC__/bower_components/bootstrap-tour/build/js/bootstrap-tour.min.js"></script>
    <!-- star rating plugin -->
    <script src="__PUBLIC__/js/jquery.raty.min.js"></script>
    <!-- for iOS style toggle switch -->
    <script src="__PUBLIC__/js/jquery.iphone.toggle.js"></script>
    <!-- autogrowing textarea plugin -->
    <script src="__PUBLIC__/js/jquery.autogrow-textarea.js"></script>
    <!-- multiple file upload plugin -->
    <script src="__PUBLIC__/js/jquery.uploadify-3.1.min.js"></script>

    <link rel="shortcut icon" href="__PUBLIC__/img/favicon.ico">
    <script type="text/javascript" src="__PUBLIC__/ckeditor/ckeditor.js"></script>
    <script src="__PUBLIC__/js/gyComm.js"></script>
    <script src="__PUBLIC__/js/jquery-ui.min.js"></script>
    <script src="__PUBLIC__/js/gyComm.js"></script>
    <script src="__PUBLIC__/js//bootstrap-slider.min.js"></script>


    <link href="__PUBLIC__/css/select2.min.css" rel="stylesheet" />
    <script src="__PUBLIC__/js/select2.min.js"></script>
    <link href="__PUBLIC__/css/bootstrap-datetimepicker.css" rel="stylesheet">
    <script src="__PUBLIC__/js/dialog-plus-min.js"></script>
</head>
<head>
    <meta charset="UTF-8">
</head>
<body>
<div class="form-group">
    <div class="col-sm-12">
        {neq name="Warning" value=""}<div class="alert alert-danger" role="alert"><strong>提示：</strong>{$Warning}</div>{/neq}
    </div>
</div>
<div class="row" style="margin-top: 20px;">
    <div class="col-sm-12">
        <table class="table table-hover table-bordered bootstrap-datatable datatable responsive">
            <thead>
            <tr>
                <th>序号</th>
                <th>整改通知单编号</th>
                <th>标题</th>
                <th>责任单位</th>
                <th>当前处理部门</th>
                <th>当前状态</th>
                <th>填写</th>
                <th>发送</th>
                {eq name= "$Think.session.Corp" value="质检科"}
                <th>删除</th>
                {/eq}
            </tr>
            </thead>
            <tbody>
            {volist name="ReformList" id="vo"}
            <tr>
                <td>
                    {$Count++}
                </td>
                <td>
                    <span style="font-size: medium;color: #00A000;">{$vo.Code}</span>
                </td>
                <td>
                    {$vo.ReformTitle}
                </td>
                <td>
                    {$vo.DutyCorp}
                </td>
                <td>

                    {neq name= "$vo.CurDealCorp" value="$Think.session.Corp"}
                        <label class="label label-warning">{$vo.CurDealCorp}</label>
                    {/neq}
                    {eq name= "$vo.CurDealCorp" value="$Think.session.Corp"}
                        <label class="label label-default">{$vo.CurDealCorp}</label>
                    {/eq}
                </td>
                <td>
                    {$vo.ReformStatus}
                </td>
                <td>
                    {neq name= "$vo.ReformStatus" value="未下发"}
                        {eq name= "$vo.CurDealCorp" value="$Think.session.Corp"}
                        <a class="btn btn-primary btn-sm" TXTZS ChildTaskID = "{$vo.ChildTaskID}" TaskID = "{$TaskID}" Code="RM{$vo.id}" rowId = "{$vo.id}" RCode = {$vo.Code}>填写</a>
                        {/eq}
                        {neq name= "$vo.CurDealCorp" value="$Think.session.Corp"}
                        <a class="btn btn-default btn-sm" TXTZS ChildTaskID = "{$vo.ChildTaskID}" TaskID = "{$TaskID}" Code="RM{$vo.id}" rowId = "{$vo.id}" RCode = {$vo.Code}>查看</a>
                        {/neq}
                    {/neq}
                    {eq name= "$vo.ReformStatus" value="未下发"}
                        <a class="btn btn-primary btn-sm" TXTZS ChildTaskID = "{$vo.ChildTaskID}" TaskID = "{$TaskID}" Code="RM{$vo.id}" rowId = "{$vo.id}" RCode = {$vo.Code}>填写</a>
                    {/eq}
                </td>
                <td>
                    {neq name= "$vo.ReformStatus" value="未下发"}
                        {eq name= "$vo.ReformStatus" value="整改效果审核通过"}
                            <a class="btn btn-success btn-sm" CLoseBtn rowId = "{$vo.id}" TaskID = "{$TaskID}">已阅</a>
                        {/eq}
                        {neq name= "$vo.ReformStatus" value="整改效果审核通过"}
                            {eq name= "$vo.CurDealCorp" value="$Think.session.Corp"}
                            <a class="btn btn-default btn-sm" XFZG rowId = "{$vo.id}" TaskID = "{$TaskID}">发送</a>
                            {/eq}
                            {neq name= "$vo.CurDealCorp" value="$Think.session.Corp"}
                            <span style="color: #00A000;font-weight: bold;">已发送至<{$vo.CurDealCorp}></span>
                            {/neq}
                        {/neq}

                    {/neq}
                    {eq name= "$vo.ReformStatus" value="未下发"}
                            <a class="btn btn-default btn-sm" XFZG rowId = "{$vo.id}" TaskID = "{$TaskID}">发送</a>
                    {/eq}
                </td>
                {eq name= "$Think.session.Corp" value="质检科"}
                <td>
                    <input type="checkbox" EnableDel style="margin-right: 10px;" rowId = "{$vo.id}" /><a BtnID="DelBtn{$vo.id}" DelBtn class="btn btn-sm btn-danger" rowId="{$vo.id}" disabled>删除</a>
                </td>
                {/eq}

            </tr>
            {/volist}
            </tbody>
        </table>
    </div>
    {eq name= "$Think.session.Corp" value="质检科"}
        <div class="row">
            <a class="btn btn-success " style="margin-left: 86%" ZJ >增加整改通知书</a>
        </div>
    {/eq}
</div>
<script>
    var Count = {$ReformCount|default='0'};
    var TabCount = 1;

    $(function () {
        //$("#aReformList",window.parent.document).text('整改通知书列表'+'<span class="badge">'+Count+'</span>');
        $("#aReformList",window.parent.document).empty();
        $("#aReformList",window.parent.document).text('整改通知书列表');
        $('<span class="badge">'+Count+'</span>').appendTo($("#aReformList",window.parent.document));
        $('a[XFZG]').click(function () {
            window.location = '/SafetyMng/Reform/SendReform/TaskID/'+$(this).attr('TaskID')+'/ReformID/'+$(this).attr('rowID');
        });

        $('a[TXTZS]').click(function () {
            PrivCode = $(this).attr('Code');
            TaskID = $(this).attr('TaskID');
            if($('#li'+PrivCode,window.parent.document).length ==0){
                $('<li id="li'+PrivCode+'"><a  href="#div'+PrivCode+'" data-toggle="tab">整改通知'+$(this).attr('RCode')+'&nbsp;<button type="button" onclick="CloseBtnClick(this);" gyCloseBtn PrivCode="'+PrivCode+'" class="close"  aria-label="Close" ><span aria-hidden="true" style="color:red">&times;</span></button>\n'+'</a></li>').appendTo($("#myTab",window.parent.document));
                $('<div class="tab-pane"  id="div'+PrivCode+'" style=""><iframe id = "Frm'+PrivCode+'" src="/SafetyMng/Reform/Index/TaskID/'+
                    TaskID+'/ReformID/'+$(this).attr("rowId")+'/opType/Mdf" scrolling="no" width="100%" onload="changeFrameHeight(\'Frm'+PrivCode+'\')" ' +
                    'frameborder="0"></iframe></div>').appendTo($('#myTabContent',window.parent.document));
            }
            // alert(NextID);
             $('#myTab > li',window.parent.document).removeClass('active');
            $('#li'+PrivCode,window.parent.document).addClass('active');
            $('#myTabContent > div',window.parent.document).removeClass('active');
            $('#div'+PrivCode,window.parent.document).addClass('active');
        });

        $('a[ZJ]').click(function () {
            NextID = 'Tab' + (++TabCount);
           // alert(NextID);
            $('<li id="li'+TabCount+'"><a  href="#div'+NextID+'" data-toggle="tab">增加整改通知书'+'&nbsp;<button type="button"  class="close" gyCloseBtn PrivCode="'+TabCount+'" aria-label="Close" ><span aria-hidden="true" style="color:red">&times;</span></button>\n'+'</a></li>').appendTo($("#myTab",window.parent.document));
            $('<div class="tab-pane"  id="div'+TabCount+'" style=""><iframe id = "Frm'+TabCount+'" src="/SafetyMng/Reform/Index/TaskID/'+{$TaskID}+'" scrolling="no" width="100%" onload="changeFrameHeight(\'Frm'+TabCount+'\')" frameborder="0"></iframe></div>').appendTo($('#myTabContent',window.parent.document));
            $('#myTab > li',window.parent.document).removeClass('active');
            $('#li'+TabCount,window.parent.document).addClass('active');
            $('#myTabContent > div',window.parent.document).removeClass('active');
            $('#div'+TabCount,window.parent.document).addClass('active');
           
        });
       $('input[EnableDel]').click(function () {
           if($(this).is(":checked")){
               $("a[BtnID=DelBtn"+$(this).attr('rowId')+"]").removeAttr('disabled');
           }else{
               $("a[BtnID=DelBtn"+$(this).attr('rowId')+"]").attr('disabled','disabled');
           }
       });

        $('a[CLoseBtn]').click(function () {
            $TaskID = $(this).attr('TaskID');
            $rowID = $(this).attr('rowID');
            var dd = dialog({
                    title: '提示',
                    content: '您点击已阅之后，任务将会被关闭？确定吗？',
                    width:440,
                    left:300,
                    top:300,
                    okValue:'确定',
                    ok: function () {
                        window.location = '/SafetyMng/Reform/SendReform/TaskID/'+$TaskID+'/ReformID/'+$rowID;
                    },
                    cancelValue:'我再看看',
                    cancel:function () {

                    }
                    }
            );
            dd.showModal();
        });

        {eq name= "$Think.session.Corp" value="质检科"}
            $('a[DelBtn]').click(function () {
                var d1 = dialog({
                    title: '删除整改通知书',
                    url: "/SafetyMng/Reform/showDeleteReform/ReformID/"+$(this).attr("rowId"),
                    width:340,
                    onclose: function () {
                        window.location.reload(true);
                    },
                });
                d1.showModal();
            });
        {/eq}



    });
</script>
</body>
</html>