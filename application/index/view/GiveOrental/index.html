<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
<body class="container-fluid　ui-widget-content">
<form id="mForm" class="form-horizontal" role="form" enctype="application/x-www-form-urlencoded" action="/Index/GiveOrental/GiveOrental" method="post" >
    {neq name="Warning" value=""}
    <div class="form-group">
        <div class="col-sm-12">
            <div class="alert alert-danger" role="alert"><strong>提示：</strong>{$Warning}</div>
        </div>
    </div>
    {/neq}
     <div style="">
         <input type="hidden" name="rowId" value="{$row['id']}"/>
         <div class="form-group">
             <label for="StoreCode" class="col-sm-2 control-label">店铺编号:</label>
             <div class="col-sm-2">
                 <div class="input-group">
                     <input type="text" class="form-control input-md" id="StoreCode"  readonly name="StoreCode" value="{$row['StoreCode']}" />
                 </div>
             </div>
             <div class="form-group ">
                 <label for="StoreName" class="col-sm-1 control-label" style="width: 90px;">店铺名称:</label>
                 <div class="col-sm-2">
                     <input type="text" class="form-control" id="StoreName"  name="StoreName" value="{$row['StoreName']}" readonly/>
                 </div>
             </div>
         </div>
        <div class="form-group">
            <label for="StoreOwner" class="col-sm-2 control-label">商户姓名:</label>
            <div class="col-sm-2">
                <input type="text" id = "StoreOwner" type="text"  class="form-control"   placeholder="" value="{$row['StoreOwner']}" readonly>
            </div>
            <div class="form-group ">
                <label for="StoreArea" class="col-sm-1 control-label">面积:</label>
                <div class="col-sm-2">
                    <input type="text" class="form-control input-md" id="StoreArea" readonly name="StoreArea" value="{$row['StoreArea']}" />
                </div>

                    <label for="StoreRental" class="col-sm-1 control-label">租金:</label>
                    <div class="col-sm-2">
                        <input type="text" class="form-control" id="StoreRental"  name="StoreRental" placeholder="" value="{$row['StoreRental']}" readonly>
                    </div>
            </div>
        </div>
         <hr/>
        <div class="form-group">
            <label for="GiverName" class="col-sm-2 control-label">缴纳人:</label>
            <div class="col-sm-2">
                <div class="input-group">
                    <input type="text" class="form-control input-md" id="GiverName" {neq name="Role" value="Filler" }readonly{/neq}  name="GiverName" value="{$row['GiverName']}" />
                </div>
            </div>
            <div class="form-group ">
                <label for="NextGiveDate" class="col-sm-1 control-label" style="width: 120px;color:blue;">本次租金到期:</label>
                <div class="col-sm-2">
                    <input type="text" class="form-control" id="NextGiveDate"  name="NextGiveDate" value="{$row['NextGiveDate']}" readonly/>
                </div>
            </div>
        </div>
        <div class="form-group ">
            <label for="JNJE" class="col-sm-2 control-label">本次缴纳金额:</label>
            <div class="col-sm-2">
                <div class="input-group">
                    <input type="text" class="form-control input-md" id="JNJE"  name="JNJE" {neq name="Role" value="Filler" }readonly{/neq} value="{$row['JNORental']}" />
                </div>
            </div>

            <span id="dxJE"style="font-weight: bold;font-size:xx-large;color: darkslategray;">零</span>

        </div>
         <div class="form-group">
                    <label for="NextGiveDateCalc" class="col-sm-2 control-label" style="color: #00A000;">下次租金到期:</label>
                    <div class="col-sm-2">
                        <div class="input-group">
                            <input type="text" class="form-control input-md" id="NextGiveDateCalc"  readonly name="NextGiveDateCalc" value="{$row['NextGiveDate']}" />
                        </div>
                    </div>
                    <div class="form-group ">
                        <label for="FeedBack" class="col-sm-1 control-label" style="width: 90px;">财务反馈:</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control" id="FeedBack" {eq name="Role" value="Filler" }readonly {/eq} name="FeedBack" value="{$row['FeedBack']}" />
                        </div>
                    </div>
         </div>


            <div class="form-group ">
                <label for="BillMaker" class="col-sm-2 control-label">开票人:</label>
                <div class="col-sm-2">
                    <div class="input-group">
                        <input type="text" class="form-control input-md" id="BillMaker"  name="BillMaker" value="{$row['BillMaker']}" readonly/>
                    </div>
                </div>
                <div class="form-group ">
                    <label for="Confirmer" class="col-sm-1 control-label" style="width: 90px;">财务确认:</label>
                    <div class="col-sm-2">
                        <div class="input-group">
                            <input type="text" class="form-control input-md" id="Confirmer"  name="Confirmer" value="{$row['Confirmer']}" readonly/>
                        </div>
                    </div>
                </div>
            </div>


        <div class="col-sm-11 col-sm-offset-1">

        </div>
        <div class="row">
            <div class="col-sm-8 col-sm-offset-2">
                <input type="hidden" id="opType" name="opType" value="0">
                {eq name="Role" value="Filler"}
                    {neq name="Status" value="0"}
                        <a id="FillBtn" class="btn btn-primary"  OptBtn style="margin-left: 10%">确认开票</a>
                    {/neq}
                    {eq name="Status" value="0"}
                        <span style="font-size: medium;color: #00A000;margin-left: 10%"><a OptBtn id="PJXZ" href="#">已开票,待财务确认!点此处下载单据。</a></span>
                    {/eq}
                {/eq}
                {eq name="Role" value="Confirmer"}
                    {eq name="Status" value="0"}
                        <a id="ConfirmBtn" class="btn btn-success" OptBtn style="margin-left: 10%">确认收款</a>
                        <a id="FeedBackBtn" class="btn btn-danger" OptBtn  style="margin-left: 10%">退回重开</a>
                    {/eq}
                {/eq}
            </div>
        </div>
    </div>

    </form>

</body>
<script>
    var NextGiveDate = "{$row['NextGiveDate']}";
    var StoreRental = "{$row['StoreRental']}";

    function DateMinus(date1,date2){
        var sdate = new Date(date1);
        var now = new Date(date2);
        var days = now.getTime() - sdate.getTime();
        var day = parseInt(days / (1000 * 60 * 60 * 24));
        return day;
    }
    
    function CalcRentalDeadDay(OrentalGived) {
        var ZS = parseInt(OrentalGived/StoreRental);
        var XS = OrentalGived/StoreRental - ZS;
        var d1 =  moment(NextGiveDate).add(ZS,"months");
       // alert("d1:"+d1.format("YYYY-MM-DD"));
        if(XS>=0.03){
            var DaysInMonths = (new Date(d1.format("YYYY"),d1.format("MM"),0)).getDate();
            var LeftDays = Math.round(DaysInMonths * XS);
           // alert("LeftDays->"+LeftDays);
            d1.add(LeftDays,"days");
        }
        //alert("Final:"+d1.format("YYYYY-MM-DD"));
        return d1.format("YYYY-MM-DD");
    }


    $(function (){

        if($("#JNJE").val()!=''){
            $("#dxJE").text(DX($("#JNJE").val()));
        }

        $("a[OptBtn]").click(function () {
            if($(this).attr("id")=="FillBtn"){
                $("#opType").val("0");
            }else if($(this).attr("id")=="ConfirmBtn"){
                $("#opType").val("2");
            }else if($(this).attr("id")=="FeedBackBtn"){
                $("#opType").val("1");
            }else if($(this).attr("id")=="PJXZ"){
                $("#opType").val("3");
            }
            $("#mForm").submit();
        });

        $("#JNJE").change(function () {
            $("#dxJE").text(DX($("#JNJE").val()));
            $("#NextGiveDateCalc").val(CalcRentalDeadDay($("#JNJE").val()));
        });

    });
    function DX(n) {
        if (!/^(0|[1-9]\d*)(\.\d+)?$/.test(n))
            return "数据非法";
        var unit = "千百拾亿千百拾万千百拾元角分", str = "";
        n += "00";
        var p = n.indexOf('.');
        if (p >= 0)
            n = n.substring(0, p) + n.substr(p+1, 2);
        unit = unit.substr(unit.length - n.length);
        for (var i=0; i < n.length; i++)
            str += '零壹贰叁肆伍陆柒捌玖'.charAt(n.charAt(i)) + unit.charAt(i);
        return str.replace(/零(千|百|拾|角)/g, "零").replace(/(零)+/g, "零").replace(/零(万|亿|元)/g, "$1").replace(/(亿)万|壹(拾)/g, "$1$2").replace(/^元零?|零分/g, "").replace(/元$/g, "元整");
    }
</script>
</html>
